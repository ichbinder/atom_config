Object.defineProperty(exports, '__esModule', {
	value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

/** @babel */

var _fs = require('fs');

var _fs2 = _interopRequireDefault(_fs);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var init = function init() {
	var basePath = '';

	if (atom.project.getPaths().length > 0) {
		basePath = atom.project.getPaths()[0];
	} else if (typeof atom.workspace.getActiveTextEditor() !== 'undefined' && atom.workspace.getActiveTextEditor().getPath()) {
		basePath = _path2['default'].dirname(atom.workspace.getActiveTextEditor().getPath());
	} else {
		atom.notifications.addError('An .editorconfig file can\'t be generated without an open file or project.');
		return;
	}

	var configFile = _path2['default'].join(basePath, '.editorconfig');

	var conf = {
		core: atom.config.get('core'),
		editor: atom.config.get('editor'),
		whitespace: atom.config.get('whitespace')
	};

	var indent = conf.editor.softTabs ? 'indent_style = space\nindent_size = ' + conf.editor.tabLength : 'indent_style = tab';

	var endOfLine = process.platform === 'win32' ? 'crlf' : 'lf';
	var charset = conf.core.fileEncoding.replace('utf8', 'utf-8') || 'utf-8';

	var ret = 'root = true\n\n[*]\n' + indent + '\nend_of_line = ' + endOfLine + '\ncharset = ' + charset + '\ntrim_trailing_whitespace = ' + conf.whitespace.removeTrailingWhitespace + '\ninsert_final_newline = ' + conf.whitespace.ensureSingleTrailingNewline + '\n\n[*.md]\ntrim_trailing_whitespace = false\n';

	_fs2['default'].access(configFile, function (err) {
		if (err) {
			_fs2['default'].writeFile(configFile, ret, function (err) {
				if (err) {
					atom.notifications.addError(err.message, { detail: err.stack });
					return;
				}

				atom.notifications.addSuccess('.editorconfig file successfully generated', {
					detail: 'An .editorconfig file was successfully generated in your project based on your current settings.'
				});
			});
		} else {
			atom.notifications.addError('An .editorconfig file already exists in your project root.');
		}
	});
};

var subscriber = function subscriber() {
	atom.commands.add('atom-workspace', 'EditorConfig:generate-config', init);
};

exports['default'] = subscriber;
exports.init = init;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2pha29iLy5hdG9tL3BhY2thZ2VzL2VkaXRvcmNvbmZpZy9jb21tYW5kcy9nZW5lcmF0ZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7OztrQkFDZSxJQUFJOzs7O29CQUNGLE1BQU07Ozs7QUFFdkIsSUFBTSxJQUFJLEdBQUcsU0FBUCxJQUFJLEdBQVM7QUFDbEIsS0FBSSxRQUFRLEdBQUcsRUFBRSxDQUFDOztBQUVsQixLQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtBQUN2QyxVQUFRLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUN0QyxNQUFNLElBQUksT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLG1CQUFtQixFQUFFLEtBQUssV0FBVyxJQUNyRSxJQUFJLENBQUMsU0FBUyxDQUFDLG1CQUFtQixFQUFFLENBQUMsT0FBTyxFQUFFLEVBQUU7QUFDaEQsVUFBUSxHQUFHLGtCQUFLLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLG1CQUFtQixFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztFQUN4RSxNQUFNO0FBQ04sTUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLDhFQUE2RSxDQUFDO0FBQ3pHLFNBQU87RUFDUDs7QUFFRCxLQUFNLFVBQVUsR0FBRyxrQkFBSyxJQUFJLENBQUMsUUFBUSxFQUFFLGVBQWUsQ0FBQyxDQUFDOztBQUV4RCxLQUFNLElBQUksR0FBRztBQUNaLE1BQUksRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUM7QUFDN0IsUUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQztBQUNqQyxZQUFVLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDO0VBQ3pDLENBQUM7O0FBRUYsS0FBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLDRDQUNLLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxHQUM1RCxvQkFBb0IsQ0FBQzs7QUFFdEIsS0FBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLFFBQVEsS0FBSyxPQUFPLEdBQUcsTUFBTSxHQUFHLElBQUksQ0FBQztBQUMvRCxLQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxJQUFJLE9BQU8sQ0FBQzs7QUFFM0UsS0FBTSxHQUFHLDRCQUlSLE1BQU0sd0JBQ1EsU0FBUyxvQkFDYixPQUFPLHFDQUNVLElBQUksQ0FBQyxVQUFVLENBQUMsd0JBQXdCLGlDQUM1QyxJQUFJLENBQUMsVUFBVSxDQUFDLDJCQUEyQixtREFJbkUsQ0FBQzs7QUFFRCxpQkFBRyxNQUFNLENBQUMsVUFBVSxFQUFFLFVBQUEsR0FBRyxFQUFJO0FBQzVCLE1BQUksR0FBRyxFQUFFO0FBQ1IsbUJBQUcsU0FBUyxDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUUsVUFBQSxHQUFHLEVBQUk7QUFDcEMsUUFBSSxHQUFHLEVBQUU7QUFDUixTQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLEVBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxLQUFLLEVBQUMsQ0FBQyxDQUFDO0FBQzlELFlBQU87S0FDUDs7QUFFRCxRQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQywyQ0FBMkMsRUFBRTtBQUMxRSxXQUFNLEVBQUUsa0dBQWtHO0tBQzFHLENBQUMsQ0FBQztJQUNILENBQUMsQ0FBQztHQUNILE1BQU07QUFDTixPQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyw0REFBNEQsQ0FBQyxDQUFDO0dBQzFGO0VBQ0QsQ0FBQyxDQUFDO0NBQ0gsQ0FBQzs7QUFFRixJQUFNLFVBQVUsR0FBRyxTQUFiLFVBQVUsR0FBUztBQUN4QixLQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSw4QkFBOEIsRUFBRSxJQUFJLENBQUMsQ0FBQztDQUMxRSxDQUFDOztxQkFFTSxVQUFVO1FBQWEsSUFBSSxHQUFKLElBQUkiLCJmaWxlIjoiL2hvbWUvamFrb2IvLmF0b20vcGFja2FnZXMvZWRpdG9yY29uZmlnL2NvbW1hbmRzL2dlbmVyYXRlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqIEBiYWJlbCAqL1xuaW1wb3J0IGZzIGZyb20gJ2ZzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuXG5jb25zdCBpbml0ID0gKCkgPT4ge1xuXHRsZXQgYmFzZVBhdGggPSAnJztcblxuXHRpZiAoYXRvbS5wcm9qZWN0LmdldFBhdGhzKCkubGVuZ3RoID4gMCkge1xuXHRcdGJhc2VQYXRoID0gYXRvbS5wcm9qZWN0LmdldFBhdGhzKClbMF07XG5cdH0gZWxzZSBpZiAodHlwZW9mIGF0b20ud29ya3NwYWNlLmdldEFjdGl2ZVRleHRFZGl0b3IoKSAhPT0gJ3VuZGVmaW5lZCcgJiZcblx0XHRhdG9tLndvcmtzcGFjZS5nZXRBY3RpdmVUZXh0RWRpdG9yKCkuZ2V0UGF0aCgpKSB7XG5cdFx0YmFzZVBhdGggPSBwYXRoLmRpcm5hbWUoYXRvbS53b3Jrc3BhY2UuZ2V0QWN0aXZlVGV4dEVkaXRvcigpLmdldFBhdGgoKSk7XG5cdH0gZWxzZSB7XG5cdFx0YXRvbS5ub3RpZmljYXRpb25zLmFkZEVycm9yKGBBbiAuZWRpdG9yY29uZmlnIGZpbGUgY2FuJ3QgYmUgZ2VuZXJhdGVkIHdpdGhvdXQgYW4gb3BlbiBmaWxlIG9yIHByb2plY3QuYCk7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0Y29uc3QgY29uZmlnRmlsZSA9IHBhdGguam9pbihiYXNlUGF0aCwgJy5lZGl0b3Jjb25maWcnKTtcblxuXHRjb25zdCBjb25mID0ge1xuXHRcdGNvcmU6IGF0b20uY29uZmlnLmdldCgnY29yZScpLFxuXHRcdGVkaXRvcjogYXRvbS5jb25maWcuZ2V0KCdlZGl0b3InKSxcblx0XHR3aGl0ZXNwYWNlOiBhdG9tLmNvbmZpZy5nZXQoJ3doaXRlc3BhY2UnKVxuXHR9O1xuXG5cdGNvbnN0IGluZGVudCA9IGNvbmYuZWRpdG9yLnNvZnRUYWJzID9cblx0XHRgaW5kZW50X3N0eWxlID0gc3BhY2VcXG5pbmRlbnRfc2l6ZSA9ICR7Y29uZi5lZGl0b3IudGFiTGVuZ3RofWAgOlxuXHRcdCdpbmRlbnRfc3R5bGUgPSB0YWInO1xuXG5cdGNvbnN0IGVuZE9mTGluZSA9IHByb2Nlc3MucGxhdGZvcm0gPT09ICd3aW4zMicgPyAnY3JsZicgOiAnbGYnO1xuXHRjb25zdCBjaGFyc2V0ID0gY29uZi5jb3JlLmZpbGVFbmNvZGluZy5yZXBsYWNlKCd1dGY4JywgJ3V0Zi04JykgfHwgJ3V0Zi04JztcblxuXHRjb25zdCByZXQgPVxuYHJvb3QgPSB0cnVlXG5cblsqXVxuJHtpbmRlbnR9XG5lbmRfb2ZfbGluZSA9ICR7ZW5kT2ZMaW5lfVxuY2hhcnNldCA9ICR7Y2hhcnNldH1cbnRyaW1fdHJhaWxpbmdfd2hpdGVzcGFjZSA9ICR7Y29uZi53aGl0ZXNwYWNlLnJlbW92ZVRyYWlsaW5nV2hpdGVzcGFjZX1cbmluc2VydF9maW5hbF9uZXdsaW5lID0gJHtjb25mLndoaXRlc3BhY2UuZW5zdXJlU2luZ2xlVHJhaWxpbmdOZXdsaW5lfVxuXG5bKi5tZF1cbnRyaW1fdHJhaWxpbmdfd2hpdGVzcGFjZSA9IGZhbHNlXG5gO1xuXG5cdGZzLmFjY2Vzcyhjb25maWdGaWxlLCBlcnIgPT4ge1xuXHRcdGlmIChlcnIpIHtcblx0XHRcdGZzLndyaXRlRmlsZShjb25maWdGaWxlLCByZXQsIGVyciA9PiB7XG5cdFx0XHRcdGlmIChlcnIpIHtcblx0XHRcdFx0XHRhdG9tLm5vdGlmaWNhdGlvbnMuYWRkRXJyb3IoZXJyLm1lc3NhZ2UsIHtkZXRhaWw6IGVyci5zdGFja30pO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGF0b20ubm90aWZpY2F0aW9ucy5hZGRTdWNjZXNzKCcuZWRpdG9yY29uZmlnIGZpbGUgc3VjY2Vzc2Z1bGx5IGdlbmVyYXRlZCcsIHtcblx0XHRcdFx0XHRkZXRhaWw6ICdBbiAuZWRpdG9yY29uZmlnIGZpbGUgd2FzIHN1Y2Nlc3NmdWxseSBnZW5lcmF0ZWQgaW4geW91ciBwcm9qZWN0IGJhc2VkIG9uIHlvdXIgY3VycmVudCBzZXR0aW5ncy4nXG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGF0b20ubm90aWZpY2F0aW9ucy5hZGRFcnJvcignQW4gLmVkaXRvcmNvbmZpZyBmaWxlIGFscmVhZHkgZXhpc3RzIGluIHlvdXIgcHJvamVjdCByb290LicpO1xuXHRcdH1cblx0fSk7XG59O1xuXG5jb25zdCBzdWJzY3JpYmVyID0gKCkgPT4ge1xuXHRhdG9tLmNvbW1hbmRzLmFkZCgnYXRvbS13b3Jrc3BhY2UnLCAnRWRpdG9yQ29uZmlnOmdlbmVyYXRlLWNvbmZpZycsIGluaXQpO1xufTtcblxuZXhwb3J0IHtzdWJzY3JpYmVyIGFzIGRlZmF1bHQsIGluaXR9O1xuIl19
//# sourceURL=/home/jakob/.atom/packages/editorconfig/commands/generate.js
